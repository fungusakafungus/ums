#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1
#export DH_OPTIONS=-v

GO_PACKAGE=github.com/nightlyone/ums

export GOPATH=$(CURDIR)/debian/go_build

%:
	dh $@ --parallel

override_dh_auto_configure:
	mkdir -p $(GOPATH)/src/$(dir $(GO_PACKAGE))
	ln -s ../../../../../ $(GOPATH)/src/$(GO_PACKAGE)
	go get $(GO_PACKAGE)

override_dh_auto_test:
	go test $(GO_PACKAGE)

override_dh_auto_build:
	go build $(GO_PACKAGE)/cmd/check_ums

override_dh_install:
	dh_install --sourcedir=$(GOPATH)/bin check_ums $(DESTDIR)/usr/lib/nagios/plugins

# These are not needed for go programs
override_dh_pysupport override_dh_pysupport2 override_dh_perl:

override_dh_clean:
	rm -rf $(GOPATH)
	dh_clean
